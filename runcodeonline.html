<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Run Code Online</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
      background: #f9f9f9;
    }

    label {
      font-weight: bold;
    }

    select, textarea, pre, button {
      width: 100%;
      font-family: monospace;
      font-size: 14px;
      padding: 10px;
      box-sizing: border-box;
      margin-bottom: 20px;
    }

    textarea {
      height: 200px;
    }

    button {
      font-size: 16px;
    }

    pre {
      background: #222;
      color: #fff;
      min-height: 100px;
    }
  </style>
</head>
<body>

<h2>Run Code Online</h2>

<label for="language">Choose a language:</label>
<select id="language" onchange="setSampleCode()">
  <option value="cpp">C++</option>
  <option value="java">Java</option>
  <option value="python3">Python</option>
  <option value="javascript">JavaScript</option>
</select>

<textarea id="code" placeholder="Enter your code here..."></textarea>

<button onclick="runCode()">Run</button>

<h3>Output:</h3>
<pre id="output"></pre>

<script>
  const languageVersions = {
    cpp: "10.2.0",
    java: "15.0.2",
    python3: "3.10.0",
    javascript: "18.15.0"
  };

  const sampleCodes = {
    cpp: `#include<iostream>
using namespace std;

int main() {
    cout << "Hello from C++!";
    return 0;
}`,
    java: `public class Main {
    public static void main(String[] args) {
        System.out.println("Hello from Java!");
    }
}`,
    python3: `print("Hello from Python!")`,
    javascript: `console.log("Hello from JavaScript!");`
  };

  function setSampleCode() {
    const lang = document.getElementById("language").value;
    document.getElementById("code").value = sampleCodes[lang] || "";
  }

  async function runCode() {
    const lang = document.getElementById("language").value;
    const version = languageVersions[lang];
    const code = document.getElementById("code").value;
    const output = document.getElementById("output");
    output.textContent = "Running...";

    try {
      const response = await fetch("https://emkc.org/api/v2/piston/execute", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          language: lang,
          version: version,
          files: [{
            name: "main." + getFileExtension(lang),
            content: code
          }]
        })
      });

      const result = await response.json();
      console.log("Piston result:", result); // xem JSON trả về

      let outputText = "";

      // nếu có result.run
      if (result.run) {
        // stdout
        if (result.run.stdout !== undefined) {
          outputText += "stdout:\n" + result.run.stdout;
        }
        // stderr
        if (result.run.stderr !== undefined && result.run.stderr !== "") {
          outputText += "\n\nstderr:\n" + result.run.stderr;
        }
      } else {
        // nếu không có run, có thể API trả lỗi
        if (result.message) {
          outputText = "Error: " + result.message;
        } else {
          outputText = "⚠️ Unexpected API response format.";
        }
      }

      output.textContent = outputText || "No output.";
    } catch (err) {
      output.textContent = "❌ Fetch error: " + err.message;
    }
  }

  function getFileExtension(lang) {
    switch (lang) {
      case "cpp": return "cpp";
      case "java": return "java";
      case "python3": return "py";
      case "javascript": return "js";
      default: return "txt";
    }
  }

  window.onload = setSampleCode;
</script>

</body>
</html>
